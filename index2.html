<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List App (Firebase v9)</title>
    
    <!-- We are using the compat version for simplicity in a plain HTML file.
         For a bundled project (e.g., with Webpack), you would use the modular version via npm.
         The compat library allows you to use the version 9 SDK with version 8 style syntax. -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Your CSS styles remain exactly the same */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; color: #333; line-height: 1.6; padding: 20px; max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .todo-form { display: flex; margin-bottom: 30px; gap: 10px; }
        .todo-input { flex: 1; padding: 15px; border: 2px solid #e1e5eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .todo-input:focus { outline: none; border-color: #2575fc; }
        .add-btn { padding: 15px 25px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: background-color 0.3s; }
        .add-btn:hover { background-color: #45a049; }
        .filter-section { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; }
        .filter-btn { padding: 10px 20px; background-color: #f1f1f1; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .filter-btn.active { background-color: #2575fc; color: white; }
        .filter-btn:hover:not(.active) { background-color: #e0e0e0; }
        .todo-list { list-style-type: none; background-color: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); overflow: hidden; }
        .todo-item { display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #f0f0f0; transition: background-color 0.2s; }
        .todo-item:last-child { border-bottom: none; }
        .todo-item:hover { background-color: #f9f9f9; }
        .todo-item.completed { opacity: 0.7; background-color: #f8f9fa; }
        .todo-text { flex: 1; margin-left: 15px; font-size: 1.1rem; }
        .todo-text.completed { text-decoration: line-through; color: #888; }
        .todo-checkbox { width: 22px; height: 22px; cursor: pointer; accent-color: #4CAF50; }
        .todo-actions { display: flex; gap: 10px; }
        .edit-btn, .delete-btn { padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
        .edit-btn { background-color: #ffc107; color: #333; }
        .edit-btn:hover { background-color: #e0a800; }
        .delete-btn { background-color: #f44336; color: white; }
        .delete-btn:hover { background-color: #d32f2f; }
        .empty-state { text-align: center; padding: 40px 20px; color: #888; }
        .loading { text-align: center; padding: 20px; color: #2575fc; font-size: 1.1rem; }
        .edit-form { display: flex; gap: 10px; width: 100%; }
        .edit-input { flex: 1; padding: 10px; border: 2px solid #2575fc; border-radius: 5px; font-size: 1rem; }
        .save-btn { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .cancel-btn { padding: 10px 15px; background-color: #888; color: white; border: none; border-radius: 5px; cursor: pointer; }
        @media (max-width: 600px) {
            .todo-form { flex-direction: column; }
            .todo-item { flex-direction: column; align-items: flex-start; gap: 15px; }
            .todo-actions { width: 100%; justify-content: flex-end; }
        }
    </style>
</head>
<body>
    <header>
        <h1>My Todo List (Firebase v9)</h1>
        <p>Stay organized and productive</p>
    </header>

    <main>
        <form class="todo-form" id="todoForm">
            <input type="text" class="todo-input" id="todoInput" placeholder="Add a new task..." required>
            <button type="submit" class="add-btn">Add Task</button>
        </form>

        <div class="filter-section">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="active">Active</button>
            <button class="filter-btn" data-filter="completed">Completed</button>
        </div>

        <ul class="todo-list" id="todoList">
            <div class="loading">Loading your todos...</div>
        </ul>
    </main>

    <script>
        // Firebase configuration - Replace with your own Firebase project config
        // How to get your config: 
        // 1. Go to https://console.firebase.google.com/
        // 2. Create a new project or select an existing one
        // 3. Click on the web icon to add a web app to your project
        // 4. Copy the configuration object and replace the values below
        const firebaseConfig = {
 apiKey: "AIzaSyBIuRj51fQUCNREMT3JEZAyWjl7TsBU_08",
 authDomain: "my-task-manager-c8e32.firebaseapp.com",
 projectId: "my-task-manager-c8e32",
 storageBucket: "my-task-manager-c8e32.firebasestorage.app",
 messagingSenderId: "182865686068",
 appId: "1:182865686068:web:ef8716eb8edcc7749c6461"
};

        // Initialize Firebase with compatibility library for version 9.22.0
        // The compat libraries allow you to use the version 9 SDK with version 8 style syntax
        // This is useful for gradual migration or for use in environments without a build step
        firebase.initializeApp(firebaseConfig);

        // Get a reference to the Firestore database service
        // In the modular approach (without compat), you would use:
        // import { getFirestore } from 'firebase/firestore';
        // const db = getFirestore();
        const db = firebase.firestore();

        // Reference to the 'todos' collection in Firestore
        // All our todo documents will be stored in this collection
        const todosCollection = db.collection('todos');

        // DOM Elements
        const todoForm = document.getElementById('todoForm');
        const todoInput = document.getElementById('todoInput');
        const todoList = document.getElementById('todoList');
        const filterBtns = document.querySelectorAll('.filter-btn');

        // State variables
        let currentFilter = 'all';
        let editingTodoId = null;

        // Event Listeners
        todoForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = todoInput.value.trim();
            
            if (text) {
                if (editingTodoId) {
                    updateTodo(editingTodoId, text);
                    editingTodoId = null;
                } else {
                    addTodo(text);
                }
                todoInput.value = '';
            }
        });

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderTodos();
            });
        });

        // Real-time listener for todos
        // This uses Firestore's onSnapshot method to listen for real-time updates
        // Whenever the todos collection changes, this callback will automatically fire
        todosCollection.onSnapshot((snapshot) => {
            // Clear the current list
            todoList.innerHTML = '';
            
            // If there are no todos, show empty state
            if (snapshot.empty) {
                todoList.innerHTML = `
                    <div class="empty-state">
                        <h3>No tasks yet</h3>
                        <p>Add a task above to get started!</p>
                    </div>
                `;
                return;
            }
            
            // Convert snapshot to an array of todos
            const todosArray = [];
            snapshot.forEach((doc) => {
                todosArray.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            // Filter todos based on current filter
            const filteredTodos = todosArray.filter(todo => {
                if (currentFilter === 'active') return !todo.completed;
                if (currentFilter === 'completed') return todo.completed;
                return true;
            });
            
            // Show message if no todos match the filter
            if (filteredTodos.length === 0) {
                let message = '';
                if (currentFilter === 'active') message = 'No active tasks';
                else if (currentFilter === 'completed') message = 'No completed tasks';
                
                todoList.innerHTML = `
                    <div class="empty-state">
                        <h3>${message}</h3>
                    </div>
                `;
                return;
            }
            
            // Render each todo item
            filteredTodos.forEach(todo => {
                const todoElement = createTodoElement(todo);
                todoList.appendChild(todoElement);
            });
        }, (error) => {
            console.error("Error listening to todos:", error);
        });

        // CRUD Operations

        // CREATE - Add a new todo to the database
        function addTodo(text) {
            // In the modular approach, you would use:
            // import { collection, addDoc } from 'firebase/firestore';
            // await addDoc(collection(db, 'todos'), { text, completed: false, createdAt: serverTimestamp() });
            todosCollection.add({
                text: text,
                completed: false,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                console.log("Todo added successfully");
            }).catch((error) => {
                console.error("Error adding todo: ", error);
            });
        }

        // READ - Handled by the real-time listener above

        // UPDATE - Update an existing todo's text
        function updateTodo(id, newText) {
            // In the modular approach, you would use:
            // import { doc, updateDoc } from 'firebase/firestore';
            // const todoRef = doc(db, 'todos', id);
            // await updateDoc(todoRef, { text: newText });
            todosCollection.doc(id).update({
                text: newText
            }).then(() => {
                console.log("Todo updated successfully");
            }).catch((error) => {
                console.error("Error updating todo: ", error);
            });
        }

        // UPDATE - Toggle todo completion status
        function toggleTodoCompletion(id, completed) {
            // In the modular approach, you would use:
            // import { doc, updateDoc } from 'firebase/firestore';
            // const todoRef = doc(db, 'todos', id);
            // await updateDoc(todoRef, { completed: !completed });
            todosCollection.doc(id).update({
                completed: !completed
            }).then(() => {
                console.log("Todo completion toggled");
            }).catch((error) => {
                console.error("Error toggling todo completion: ", error);
            });
        }

        // DELETE - Remove a todo from the database
        function deleteTodo(id) {
            // In the modular approach, you would use:
            // import { doc, deleteDoc } from 'firebase/firestore';
            // await deleteDoc(doc(db, 'todos', id));
            todosCollection.doc(id).delete().then(() => {
                console.log("Todo deleted successfully");
            }).catch((error) => {
                console.error("Error deleting todo: ", error);
            });
        }

        // UI Functions

        // Create a DOM element for a todo item
        function createTodoElement(todo) {
            const li = document.createElement('li');
            li.className = `todo-item ${todo.completed ? 'completed' : ''}`;
            li.dataset.id = todo.id;

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'todo-checkbox';
            checkbox.checked = todo.completed;
            checkbox.addEventListener('change', () => {
                toggleTodoCompletion(todo.id, todo.completed);
            });

            const textSpan = document.createElement('span');
            textSpan.className = `todo-text ${todo.completed ? 'completed' : ''}`;
            textSpan.textContent = todo.text;

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'todo-actions';

            const editBtn = document.createElement('button');
            editBtn.className = 'edit-btn';
            editBtn.textContent = 'Edit';
            editBtn.addEventListener('click', () => {
                startEditingTodo(todo.id, todo.text);
            });

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'Delete';
            deleteBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this task?')) {
                    deleteTodo(todo.id);
                }
            });

            actionsDiv.appendChild(editBtn);
            actionsDiv.appendChild(deleteBtn);
            
            li.appendChild(checkbox);
            li.appendChild(textSpan);
            li.appendChild(actionsDiv);

            return li;
        }

        // Start editing a todo
        function startEditingTodo(id, currentText) {
            const todoElement = document.querySelector(`.todo-item[data-id="${id}"]`);
            const textSpan = todoElement.querySelector('.todo-text');
            
            const editForm = document.createElement('form');
            editForm.className = 'edit-form';
            
            const editInput = document.createElement('input');
            editInput.type = 'text';
            editInput.className = 'edit-input';
            editInput.value = currentText;
            editInput.required = true;
            
            const saveBtn = document.createElement('button');
            saveBtn.type = 'submit';
            saveBtn.className = 'save-btn';
            saveBtn.textContent = 'Save';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.type = 'button';
            cancelBtn.className = 'cancel-btn';
            cancelBtn.textContent = 'Cancel';
            
            editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newText = editInput.value.trim();
                if (newText) {
                    updateTodo(id, newText);
                }
            });
            
            cancelBtn.addEventListener('click', () => {
                // Re-render the todos to cancel editing
                todosCollection.get().then((snapshot) => {
                    renderTodosFromSnapshot(snapshot);
                });
            });
            
            editForm.appendChild(editInput);
            editForm.appendChild(saveBtn);
            editForm.appendChild(cancelBtn);
            
            textSpan.replaceWith(editForm);
            editInput.focus();
            editingTodoId = id;
        }

        // Helper function to render todos from a snapshot
        function renderTodosFromSnapshot(snapshot) {
            todoList.innerHTML = '';
            
            if (snapshot.empty) {
                todoList.innerHTML = `
                    <div class="empty-state">
                        <h3>No tasks yet</h3>
                        <p>Add a task above to get started!</p>
                    </div>
                `;
                return;
            }
            
            const todosArray = [];
            snapshot.forEach((doc) => {
                todosArray.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            const filteredTodos = todosArray.filter(todo => {
                if (currentFilter === 'active') return !todo.completed;
                if (currentFilter === 'completed') return todo.completed;
                return true;
            });
            
            if (filteredTodos.length === 0) {
                let message = '';
                if (currentFilter === 'active') message = 'No active tasks';
                else if (currentFilter === 'completed') message = 'No completed tasks';
                
                todoList.innerHTML = `
                    <div class="empty-state">
                        <h3>${message}</h3>
                    </div>
                `;
                return;
            }
            
            filteredTodos.forEach(todo => {
                const todoElement = createTodoElement(todo);
                todoList.appendChild(todoElement);
            });
        }

        // Manual render function (used when canceling edits)
        function renderTodos() {
            todosCollection.get().then((snapshot) => {
                renderTodosFromSnapshot(snapshot);
            }).catch((error) => {
                console.error("Error getting todos: ", error);
            });
        }
    </script>
</body>
</html>